{% extends 'base.html' %}
{% load static %}

{% block title %}{{ outfit.name }} - Tailora{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wardrobe.css' %}">
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
<link rel="stylesheet" href="{% static 'css/outfits.css' %}">

<style>
    /* 1. LAYOUT CONTAINER FIX */
    .outfit-detail-container {
        max-width: 960px;
        margin: 40px auto;
        padding: 0 20px;
    }

    /* 2. GRID LAYOUT FOR TOP SECTION */
    .outfit-top-grid {
        display: grid;
        grid-template-columns: 400px 1fr;
        /* Fixed width for image column */
        gap: 40px;
        align-items: start;
    }

    /* 3. ITEMS GRID FIX */
    .wardrobe-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    /* Card Styling - NO BORDER RADIUS */
    /* Premium Card Styles */
    .wardrobe-item {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 0;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .wardrobe-item:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        z-index: 2;
    }

    .item-image {
        position: relative;
        padding-top: 133.33%;
        /* 3:4 Aspect Ratio */
        background: #f8f8f8;
        overflow: hidden;
    }

    .item-image img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .wardrobe-item:hover .item-image img {
        transform: scale(1.12);
    }

    /* Info Styles */
    .info-group {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 12px;
    }

    .info-group:last-child {
        border-bottom: none;
    }

    .info-label {
        font-family: 'Inter', sans-serif;
        font-size: 12px;
        font-weight: 600;
        color: #757575;
        text-transform: uppercase;
        letter-spacing: 1px;
        display: block;
        margin-bottom: 4px;
    }

    .info-value {
        font-family: 'Inter', sans-serif;
        font-size: 15px;
        color: #2c2c2c;
        line-height: 1.5;
    }

    /* Mobile Responsiveness */
    @media (max-width: 800px) {
        .outfit-top-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Main Wrapper -->
<div class="outfit-detail-container">

    <!-- Page Header -->
    <div class="page-header" style="margin-bottom: 32px;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
            <div>
                <a href="{% url 'outfits:outfit_gallery' %}"
                    style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575; text-decoration: none; display: inline-block; margin-bottom: 8px;">
                    &larr; Back to Outfits
                </a>
                <h1 class="page-title" style="margin: 0; font-size: 28px;">{{ outfit.name }}</h1>
                <p class="page-subtitle" style="margin-top: 4px; color: #666;">
                    {{ outfit.get_occasion_display }} • {{ outfit.items.count }} item{{ outfit.items.count|pluralize }}
                </p>
            </div>
            <div style="display: flex; gap: 12px;">
                <a href="{% url 'outfits:challenges_list' %}" class="btn btn-secondary"
                    style="border-radius: 0;">Challenges</a>
                <a href="{% url 'outfits:outfit_edit' outfit.id %}" class="btn btn-secondary"
                    style="border-radius: 0;">Edit</a>
                <a href="{% url 'outfits:outfit_gallery' %}" class="btn btn-secondary"
                    style="border-radius: 0;">Back</a>
            </div>
        </div>
    </div>

    <!-- Messages -->
    {% if messages %}
    <div style="margin-bottom: 24px;">
        {% for message in messages %}
        <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}"
            style="padding: 12px; border-radius: 0; margin-bottom: 8px; border: 1px solid transparent;
                    {% if message.tags == 'error' %}background:#fde8e8; color:#9b1c1c; border-color:#f8b4b4;{% else %}background:#def7ec; color:#03543f; border-color:#84e1bc;{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content Card -->
    <div
        style="background: #ffffff; padding: 40px; border: 1px solid #e0e0e0; border-radius: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">

        <div class="outfit-top-grid">
            <!-- Left Column: Outfit Image -->
            <div>
                <div
                    style="position: relative; background: #fafafa; border: 1px solid #e0e0e0; overflow: hidden; border-radius: 0; padding-top: 133%;">
                    <!-- Image Logic -->
                    {% if outfit.outfit_image %}
                    <img src="{{ outfit.outfit_image.url }}" alt="{{ outfit.name }}"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                    {% with outfit.items.first as first_item %}
                    {% if first_item %}
                    <img src="{{ first_item.image.url }}" alt="{{ outfit.name }}"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                    <div
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #999; text-transform: uppercase; letter-spacing: 1px;">
                        No Image
                    </div>
                    {% endif %}
                    {% endwith %}
                    {% endif %}
                </div>

                <!-- Quick Actions -->
                <div style="display: flex; gap: 12px; margin-top: 16px;">
                    <form method="post" action="{% url 'outfits:outfit_toggle_favorite' outfit.id %}" style="flex: 1;">
                        {% csrf_token %}
                        <button type="submit"
                            class="btn {% if outfit.favorite %}btn-primary{% else %}btn-secondary{% endif %}"
                            style="width: 100%; border-radius: 0;">
                            {% if outfit.favorite %}★ Remove Favorite{% else %}☆ Add to Favorites{% endif %}
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Details -->
            <div>
                <div class="settings-section">
                    <h3 class="section-title"
                        style="margin-top: 0; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0;">
                        Information
                    </h3>

                    <div class="info-group">
                        <label class="info-label">Occasion</label>
                        <span class="info-value">{{ outfit.get_occasion_display }}</span>
                    </div>

                    {% if outfit.description %}
                    <div class="info-group">
                        <label class="info-label">Description</label>
                        <span class="info-value">{{ outfit.description }}</span>
                    </div>
                    {% endif %}

                    <div class="info-group">
                        <label class="info-label">Created on</label>
                        <span class="info-value">{{ outfit.created_at|date:"F j, Y" }}</span>
                    </div>

                    {% if outfit.wear_count > 0 %}
                    <div class="info-group">
                        <label class="info-label">Times Worn</label>
                        <span class="info-value">{{ outfit.wear_count }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Items in Outfit Section -->
        <div class="settings-section" style="margin-top: 60px;">
            <h3 class="section-title"
                style="margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0;">
                Items in this outfit ({{ outfit.items.count }})
            </h3>

            {% if outfit.items.count %}
            <div class="wardrobe-grid stagger-children">
                {% for item in outfit.items.all %}
                <div class="wardrobe-item animate-fade-in-up">
                    <a href="{% url 'wardrobe:wardrobe_detail' item.id %}" class="item-link"
                        style="text-decoration: none; color: inherit;">
                        <div class="item-image">
                            <img src="{{ item.image.url }}" alt="{{ item.name }}">
                        </div>
                        <div style="padding: 12px;">
                            <h3 style="margin: 0; font-size: 14px; color: #333;">{{ item.name }}</h3>
                            <p style="margin: 4px 0 0; font-size: 12px; color: #777;">{{ item.category.name }}</p>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 40px; background: #f9f9f9; border-radius: 0; color: #757575;">
                No items added to this outfit yet.
            </div>
            {% endif %}
        </div>

        <!-- Danger Zone -->
        <div class="settings-section" style="margin-top: 60px; border-top: 1px solid #eee; padding-top: 40px;">
            <h3 class="section-title" style="color: #c62828; margin-top: 0;">Danger Zone</h3>
            <div style="border: 1px solid #ffcdd2; background: #ffebee; padding: 20px; border-radius: 0;">
                <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #c62828; margin: 0 0 16px 0;">
                    Deleting this outfit will permanently remove it. The items inside will remain in your wardrobe.
                </p>
                <form id="delete-outfit-form-{{ outfit.id }}" method="post"
                    action="{% url 'outfits:outfit_delete' outfit.id %}">
                    {% csrf_token %}
                    <button type="button" class="btn btn-primary delete-trigger"
                        data-form-id="delete-outfit-form-{{ outfit.id }}" data-item-name="this outfit"
                        style="background: #c62828; border-color: #c62828; border-radius: 0;">
                        Delete Outfit
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- Critique Popup -->
{% if critique %}
{% include 'components/critique_popup.html' %}
{% endif %}

{% endblock %}