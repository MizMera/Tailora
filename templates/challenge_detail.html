{% extends 'base.html' %}
{% load static %}

{% block title %}{{ challenge.name }} - Tailora{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wardrobe.css' %}">
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
<style>
.challenge-hero {
    background: linear-gradient(135deg, #f4e9cf 0%, #e8dfc7 100%);
    padding: 40px;
    border-radius: 8px;
    margin-bottom: 32px;
    text-align: center;
}
.challenge-type {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #757575;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
}
.challenge-title {
    font-family: 'Istok Web', sans-serif;
    font-size: 32px;
    font-weight: 400;
    color: #2c2c2c;
    margin: 0 0 16px 0;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.challenge-description {
    font-family: 'Inter', sans-serif;
    font-size: 16px;
    color: #2c2c2c;
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto 24px auto;
}
.challenge-meta {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin-bottom: 24px;
}
.meta-item {
    text-align: center;
}
.meta-value {
    font-family: 'Istok Web', sans-serif;
    font-size: 24px;
    font-weight: 600;
    color: #2c2c2c;
    display: block;
}
.meta-label {
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    color: #757575;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.progress-section {
    background: #ffffff;
    padding: 24px;
    border-radius: 8px;
    margin-bottom: 24px;
    border: 1px solid #e0e0e0;
    margin-left: 0;
}
.progress-bar {
    width: 100%;
    height: 12px;
    background: #e0e0e0;
    border-radius: 6px;
    overflow: hidden;
    margin: 16px 0;
}
.progress-fill {
    height: 100%;
    background: #2c2c2c;
    transition: width 0.3s ease;
}
.progress-text {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #757575;
    text-align: center;
}
.submitted-outfits {
    margin-top: 32px;
    padding-left: 0;
}
.submitted-outfits h3 {
    margin-left: 0;
}
.outfit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 16px;
    padding-left: 0;
}
.submitted-outfit {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    background: #ffffff;
}
.submitted-outfit img {
    width: 100%;
    height: 150px;
    object-fit: cover;
}
.submitted-outfit-info {
    padding: 12px;
}
.submitted-outfit-name {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #2c2c2c;
    margin: 0 0 4px 0;
}
.submitted-outfit-date {
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    color: #757575;
}
.action-buttons {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    justify-content: center;
}
.status-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 20px;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 16px;
}
.status-active {
    background: #e8f5e8;
    color: #2e7d32;
}
.status-completed {
    background: #e3f2fd;
    color: #1565c0;
}
.rules-section {
    background: #fafafa;
    padding: 24px;
    border-radius: 8px;
    margin: 24px 0;
    margin-left: 0;
}
.section-title {
    font-family: 'Istok Web', sans-serif;
    font-size: 18px;
    font-weight: 600;
    color: #2c2c2c;
    margin-bottom: 24px;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 12px;
    flex-shrink: 0;
}
.rules-title {
    font-family: 'Istok Web', sans-serif;
    font-size: 18px;
    font-weight: 600;
    color: #2c2c2c;
    margin-bottom: 12px;
}
.rules-content {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #757575;
    line-height: 1.6;
}
.content-wrapper {
    display: flex;
    flex-direction: column;
    gap: 32px;
}
.section-block {
    padding-left: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
        <div>
            <h1 class="page-title">{{ challenge.name }}</h1>
            <p class="page-subtitle">{{ challenge.get_challenge_type_display }} Challenge</p>
        </div>
        <a href="{% url 'outfits:challenges_list' %}" class="btn btn-secondary">Back to Challenges</a>
    </div>
</div>

<!-- Challenge Hero -->
<div style="padding: 0 32px;">
<div class="challenge-hero">
    <div class="challenge-type">{{ challenge.get_challenge_type_display }} CHALLENGE</div>
    <h1 class="challenge-title">{{ challenge.name }}</h1>
    <p class="challenge-description">{{ challenge.description }}</p>
    
    <div class="challenge-meta">
        <div class="meta-item">
            <span class="meta-value">{{ challenge.duration_days }}</span>
            <span class="meta-label">Days</span>
        </div>
        <div class="meta-item">
            <span class="meta-value">{{ challenge.participants_count }}</span>
            <span class="meta-label">Participants</span>
        </div>
        <div class="meta-item">
            <span class="meta-value">{{ challenge.rules.required_outfits|default:challenge.duration_days }}</span>
            <span class="meta-label">Outfits Required</span>
        </div>
    </div>

</div>
</div>

<!-- Rules Section -->
<div style="padding: 0 32px;">
<div class="rules-section">
    <h3 class="rules-title">Challenge Rules</h3>
    <div class="rules-content">
        {% if challenge.rules.custom_rules %}
            {{ challenge.rules.custom_rules|linebreaks }}
        {% else %}
            <p>Create and submit {{ challenge.rules.required_outfits|default:challenge.duration_days }} outfits that follow the theme of this challenge.</p>
            <p>Each outfit must be unique and created specifically for this challenge.</p>
            <p>Complete all required outfits before the challenge end date to earn your badge!</p>
        {% endif %}
    </div>
</div>
</div>

<!-- Progress Section -->
<div style="padding: 0 32px;">
{% if participation %}
<div class="progress-section">
    <h3 style="font-family: 'Istok Web', sans-serif; font-size: 18px; font-weight: 600; color: #2c2c2c; margin-bottom: 16px;">
        Your Progress
    </h3>
    
    <div class="progress-bar">
        <div class="progress-fill" style="width: {{ progress }}%"></div>
    </div>
    <div class="progress-text">
        {{ participation.outfits_submitted }} of {{ challenge.rules.required_outfits|default:challenge.duration_days }} outfits submitted ({{ progress }}%)
    </div>

    <div class="action-buttons">
        {% if not participation.completed %}
        <a href="{% url 'outfits:submit_challenge_outfit' challenge.id %}" class="btn btn-primary">Submit New Outfit</a>
        {% endif %}
        <a href="{% url 'outfits:challenges_list' %}" class="btn btn-secondary">Back to Challenges</a>
    </div>
</div>
</div>
{% elif can_join %}
<div style="padding: 0 32px;">
<div class="progress-section" style="text-align: center;">
    <h3 style="font-family: 'Istok Web', sans-serif; font-size: 18px; font-weight: 600; color: #2c2c2c; margin-bottom: 16px;">
        Join This Challenge
    </h3>
    <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575; margin-bottom: 24px;">
        Ready to take on this style challenge? Join now and start submitting your outfits!
    </p>
    <div class="action-buttons">
        <a href="{% url 'outfits:join_challenge' challenge.id %}" class="btn btn-primary">Join Challenge</a>
        <a href="{% url 'outfits:challenges_list' %}" class="btn btn-secondary">Back to Challenges</a>
    </div>
</div>
</div>
{% elif is_locked %}
<div style="padding: 0 32px;">
<div class="progress-section" style="text-align: center; background: #f5f5f5; opacity: 0.7;">
    <h3 style="font-family: 'Istok Web', sans-serif; font-size: 18px; font-weight: 600; color: #757575; margin-bottom: 16px;">
        This Challenge Has Ended
    </h3>
    <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #9e9e9e; margin-bottom: 24px;">
        This challenge period has passed. You can still view the details, but you cannot join it now.
    </p>
    <div class="action-buttons">
        <a href="{% url 'outfits:challenges_list' %}" class="btn btn-secondary">Back to Challenges</a>
    </div>
</div>
</div>
{% endif %}

<!-- Submitted Outfits -->
<div style="padding: 0 32px;">
{% if submitted_outfits %}
<div class="submitted-outfits">
    <h3 class="section-title">Your Submitted Outfits ({{ submitted_outfits|length }})</h3>
    
    <div class="outfit-grid">
        {% for challenge_outfit in submitted_outfits %}
        <div class="submitted-outfit">
            <a href="{% url 'outfits:outfit_detail' challenge_outfit.outfit.id %}">
                {% if challenge_outfit.outfit.outfit_image %}
                <img src="{{ challenge_outfit.outfit.outfit_image.url }}" alt="{{ challenge_outfit.outfit.name }}">
                {% else %}
                {% with challenge_outfit.outfit.items.first as first_item %}
                    {% if first_item %}
                    <img src="{{ first_item.image.url }}" alt="{{ challenge_outfit.outfit.name }}">
                    {% else %}
                    <div style="height: 150px; display: flex; align-items: center; justify-content: center; background: #f4e9cf;">
                        <span style="font-size: 24px;">üëî</span>
                    </div>
                    {% endif %}
                {% endwith %}
                {% endif %}
            </a>
            <div class="submitted-outfit-info">
                <div class="submitted-outfit-name">{{ challenge_outfit.outfit.name }}</div>
                <div class="submitted-outfit-date">{{ challenge_outfit.submitted_at|date:"M d, Y" }}</div>
                {% if challenge_outfit.notes %}
                <div style="font-family: 'Inter', sans-serif; font-size: 12px; color: #757575; margin-top: 4px;">
                    {{ challenge_outfit.notes|truncatewords:10 }}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% elif participation %}
<div class="submitted-outfits">
    <h3 class="section-title">Your Submitted Outfits</h3>
    <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575; text-align: center; padding: 40px;">
        No outfits submitted yet. <a href="{% url 'outfits:submit_challenge_outfit' challenge.id %}" style="color: #2c2c2c;">Submit your first outfit</a> to get started!
    </p>
</div>
</div>
{% endif %}

<!-- Challenge Info -->
<div>
<div class="content-section" style="margin-top: 32px; background: #ffffff; padding: 32px; border-radius: 8px; border: 1px solid #e0e0e0;">
    <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: 32px; border-bottom: 1px solid #e0e0e0; padding-bottom: 24px;">
        <h3 style="font-family: 'Istok Web', sans-serif; font-size: 18px; font-weight: 600; color: #2c2c2c; text-transform: uppercase; letter-spacing: 1px; margin: 0;">Challenge Details</h3>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <div>
            <label class="input-label">Created By</label>
            <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #2c2c2c; margin: 8px 0 0 0;">
                {{ challenge.created_by.email }}
            </p>
        </div>
        <div>
            <label class="input-label">Start Date</label>
            <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #2c2c2c; margin: 8px 0 0 0;">
                {{ challenge.start_date|date:"F d, Y" }}
            </p>
        </div>
        <div>
            <label class="input-label">End Date</label>
            <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #2c2c2c; margin: 8px 0 0 0;">
                {{ challenge.end_date|date:"F d, Y" }}
            </p>
        </div>
        <div>
            <label class="input-label">Visibility</label>
            <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #2c2c2c; margin: 8px 0 0 0;">
                {% if challenge.is_public %}Public{% else %}Private{% endif %}
            </p>
        </div>
    </div>
</div>
</div>

<!-- Challenge Status Badge -->
<div style="padding: 0 32px; margin-top: 24px; margin-bottom: 32px;">
    <div style="background: #ffffff; padding: 28px 32px; border-radius: 8px; border: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <div style="flex: 1;">
            <h3 style="font-family: 'Istok Web', sans-serif; font-size: 16px; font-weight: 600; color: #2c2c2c; text-transform: uppercase; letter-spacing: 1px; margin: 0;">STATUS</h3>
        </div>
        
        {% if participation %}
            <div style="flex: 0 0 auto; margin-left: 16px;">
                {% if participation.completed %}
                    <div style="display: inline-flex; align-items: center; gap: 8px; background: #e8f5e8; color: #2e7d32; padding: 12px 24px; border-radius: 20px; font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                        <span style="font-size: 18px; line-height: 1;">‚úì</span>
                        COMPLETED
                    </div>
                {% else %}
                    <div style="display: inline-flex; align-items: center; gap: 8px; background: #fce4ec; color: #c2185b; padding: 12px 24px; border-radius: 20px; font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border: 2px solid #c2185b;">
                        <span style="font-size: 18px; line-height: 1;">‚è±</span>
                        IN PROGRESS
                    </div>
                {% endif %}
            </div>
        {% elif is_locked %}
            <div style="flex: 0 0 auto; margin-left: 16px;">
                <div style="display: inline-flex; align-items: center; gap: 8px; background: #f3e5f5; color: #7b1fa2; padding: 12px 24px; border-radius: 20px; font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7;">
                    <span style="font-size: 18px; line-height: 1;">üîí</span>
                    PASSED
                </div>
            </div>
        {% else %}
            <div style="flex: 0 0 auto; margin-left: 16px;">
                <div style="display: inline-flex; align-items: center; gap: 8px; background: #f5f5f5; color: #757575; padding: 12px 24px; border-radius: 20px; font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                    <span style="font-size: 18px; line-height: 1;">‚Äî</span>
                    NOT JOINED
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}