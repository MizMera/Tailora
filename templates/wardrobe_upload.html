{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter un article - Tailora</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/wardrobe.css' %}">
</head>
<body>
    <div class="dashboard-container wardrobe-upload-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1>Ajouter un article</h1>
                <p class="subtitle">{{ remaining_slots }} / {{ max_items }} emplacements disponibles</p>
            </div>
            <div class="header-right">
                <a href="{% url 'wardrobe_gallery' %}" class="btn btn-secondary">Retour</a>
            </div>
        </header>

        <!-- Messages -->
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="message {{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Upload Form -->
        <form method="post" enctype="multipart/form-data" class="wardrobe-form">
            {% csrf_token %}
            
            <div class="form-section">
                <h2 class="section-title">Photo du vêtement</h2>
                
                <div class="image-upload-area">
                    <input 
                        type="file" 
                        id="image-input" 
                        name="image" 
                        accept="image/*" 
                        required
                        class="file-input"
                    >
                    <label for="image-input" class="upload-label">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="3" y="3" width="18" height="18" rx="2" stroke-width="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
                            <path d="m21 15-5-5L5 21" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div>
                            <p class="upload-title">Cliquez ou glissez votre image</p>
                            <p class="upload-subtitle">JPG ou PNG (max 5 MB)</p>
                        </div>
                    </label>
                    <div id="image-preview" class="image-preview" style="display: none;">
                        <img id="preview-img" src="" alt="Aperçu">
                        <button type="button" class="btn-remove-image">Supprimer</button>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-section form-col-2">
                    <label class="form-label">Nom du vêtement <span class="required">*</span></label>
                    <input 
                        type="text" 
                        name="name" 
                        placeholder="Ex: T-shirt bleu marine"
                        required
                        class="form-input"
                    >
                </div>

                <div class="form-section form-col-2">
                    <label class="form-label">Catégorie</label>
                    <select name="category" class="form-input">
                        <option value="">Sélectionner une catégorie</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.icon }} {{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-section">
                <label class="form-label">Description</label>
                <textarea 
                    name="description" 
                    placeholder="Décrivez ce vêtement..."
                    rows="3"
                    class="form-input form-textarea"
                ></textarea>
            </div>

            <div class="form-row">
                <div class="form-section form-col-2">
                    <label class="form-label">Couleur <span class="required">*</span></label>
                    <input 
                        type="text" 
                        name="color" 
                        placeholder="Ex: Bleu marine"
                        required
                        class="form-input"
                    >
                </div>

                <div class="form-section form-col-2">
                    <label class="form-label">Code couleur (hex)</label>
                    <div class="color-input-wrapper">
                        <input 
                            type="color" 
                            name="color_hex"
                            class="color-picker"
                        >
                        <input 
                            type="text" 
                            placeholder="#RRGGBB"
                            class="color-hex-display form-input"
                            readonly
                        >
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-section form-col-2">
                    <label class="form-label">Marque</label>
                    <input 
                        type="text" 
                        name="brand" 
                        placeholder="Ex: Nike, Zara..."
                        class="form-input"
                    >
                </div>

                <div class="form-section form-col-2">
                    <label class="form-label">Matière</label>
                    <input 
                        type="text" 
                        name="material" 
                        placeholder="Ex: Coton 100%"
                        class="form-input"
                    >
                </div>
            </div>

            <div class="form-row">
                <div class="form-section form-col-2">
                    <label class="form-label">Motif</label>
                    <select name="pattern" class="form-input">
                        <option value="">Aucun</option>
                        <option value="solid">Uni</option>
                        <option value="striped">Rayé</option>
                        <option value="floral">Fleuri</option>
                        <option value="plaid">Carreaux</option>
                        <option value="polka_dot">Pois</option>
                        <option value="geometric">Géométrique</option>
                        <option value="animal">Animal</option>
                        <option value="other">Autre</option>
                    </select>
                </div>

                <div class="form-section form-col-2">
                    <label class="form-label">État</label>
                    <select name="condition" class="form-input">
                        <option value="good">Bon</option>
                        <option value="new">Neuf</option>
                        <option value="excellent">Excellent</option>
                        <option value="fair">Correct</option>
                        <option value="worn">Usé</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Saisons et occasions</h2>
                
                <div class="checkbox-group">
                    <label class="form-label">Saisons</label>
                    <div class="checkbox-list">
                        <label class="checkbox-item">
                            <input type="checkbox" name="seasons" value="spring">
                            <span>Printemps</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="seasons" value="summer">
                            <span>Été</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="seasons" value="fall">
                            <span>Automne</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="seasons" value="winter">
                            <span>Hiver</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="seasons" value="all_seasons">
                            <span>Toutes saisons</span>
                        </label>
                    </div>
                </div>

                <div class="checkbox-group">
                    <label class="form-label">Occasions</label>
                    <div class="checkbox-list">
                        <label class="checkbox-item">
                            <input type="checkbox" name="occasions" value="casual">
                            <span>Casual</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="occasions" value="formal">
                            <span>Formel</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="occasions" value="sport">
                            <span>Sport</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="occasions" value="party">
                            <span>Soirée</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="occasions" value="work">
                            <span>Travail</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">Informations d'achat</h2>
                
                <div class="form-row">
                    <div class="form-section form-col-2">
                        <label class="form-label">Date d'achat</label>
                        <input type="date" name="purchase_date" class="form-input">
                    </div>

                    <div class="form-section form-col-2">
                        <label class="form-label">Prix (EUR)</label>
                        <input 
                            type="number" 
                            name="purchase_price" 
                            placeholder="0.00"
                            step="0.01"
                            min="0"
                            class="form-input"
                        >
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-section form-col-2">
                        <label class="form-label">Lieu d'achat</label>
                        <input 
                            type="text" 
                            name="purchase_location" 
                            placeholder="Ex: Zara, H&M, Thrifted..."
                            class="form-input"
                        >
                    </div>

                    <div class="form-section form-col-2">
                        <label class="checkbox-item">
                            <input type="checkbox" name="is_secondhand">
                            <span>Article de seconde main</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <label class="form-label">Étiquettes (séparées par des virgules)</label>
                <input 
                    type="text" 
                    name="tags" 
                    placeholder="Ex: confortable, été, bleu"
                    class="form-input"
                >
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg">Ajouter à ma garde-robe</button>
                <a href="{% url 'wardrobe_gallery' %}" class="btn btn-secondary btn-lg">Annuler</a>
            </div>
        </form>
    </div>

    <script>
        // Image preview
        const fileInput = document.getElementById('image-input');
        const imagePreview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        const uploadLabel = document.querySelector('.upload-label');
        const btnRemoveImage = document.querySelector('.btn-remove-image');

        fileInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImg.src = event.target.result;
                    imagePreview.style.display = 'flex';
                    uploadLabel.style.display = 'none';
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        btnRemoveImage.addEventListener('click', function(e) {
            e.preventDefault();
            fileInput.value = '';
            imagePreview.style.display = 'none';
            uploadLabel.style.display = 'flex';
        });

        // Drag and drop
        uploadLabel.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadLabel.style.background = '#f5f5f5';
        });

        uploadLabel.addEventListener('dragleave', () => {
            uploadLabel.style.background = '';
        });

        uploadLabel.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadLabel.style.background = '';
            fileInput.files = e.dataTransfer.files;
            fileInput.dispatchEvent(new Event('change'));
        });

        // Color picker sync
        const colorPicker = document.querySelector('.color-picker');
        const colorHexDisplay = document.querySelector('.color-hex-display');

        colorPicker.addEventListener('change', (e) => {
            colorHexDisplay.value = e.target.value.toUpperCase();
        });

        colorHexDisplay.addEventListener('change', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                colorPicker.value = e.target.value;
            }
        });

        // Fade in animation
        document.addEventListener('DOMContentLoaded', () => {
            document.body.style.opacity = '1';
        });
    </script>

    <style>
        body {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</body>
</html>
