{% extends 'base.html' %}
{% load static %}

{% block title %}Ajouter un article - Tailora{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wardrobe.css' %}">
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}

{% block container_class %}page-reveal{% endblock %}

{% block content %}
<!-- Page Header -->
            <div class="page-header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div>
                        <h1 class="page-title">Ajouter un article</h1>
                        <p style="font-family: 'Inter', sans-serif; font-size: 16px; color: #757575; margin-top: 8px;">{{ remaining_slots }} / {{ max_items }} emplacements disponibles</p>
                    </div>
                    <div>
                        <a href="{% url 'wardrobe_gallery' %}" class="btn btn-secondary">Retour</a>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="message {% if message.tags == 'error' %}message-error{% else %}message-success{% endif %}" style="margin: 0; border-left: none; border-bottom: 1px solid #e0e0e0; padding: 16px 40px;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Upload Form -->
            <div style="background: #ffffff; padding: 40px;">
                <form method="post" enctype="multipart/form-data" id="uploadForm">
                    {% csrf_token %}
                    
                    <div class="settings-section">
                        <h3 class="section-title">Photo du vêtement</h3>
                        
                        <div class="image-upload-area" style="padding: 40px; background: #fafafa; border: 2px dashed #d9d9d9; text-align: center; cursor: pointer;">
                            <input 
                                type="file" 
                                id="image-input" 
                                name="image" 
                                accept="image/*" 
                                required
                                style="display: none;"
                            >
                            <label for="image-input" style="cursor: pointer; display: block;">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#757575" style="margin: 0 auto 16px;">
                                    <rect x="3" y="3" width="18" height="18" stroke-width="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5" fill="#757575"/>
                                    <path d="m21 15-5-5L5 21" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <p style="font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 600; color: #252320; margin-bottom: 4px;">Cliquez pour ajouter une image</p>
                                <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575;">JPG ou PNG (max 5 MB)</p>
                            </label>
                            <div id="image-preview" class="image-preview" style="display: none; margin-top: 24px;">
                                <img id="preview-img" src="" alt="Aperçu" style="max-width: 300px; max-height: 300px; border: 1px solid #d9d9d9;">
                                <button type="button" class="btn btn-secondary" style="margin-top: 16px;">Supprimer</button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="section-title">Informations de base</h3>
                        
                        <div class="form-grid">
                            <div class="input-field">
                                <label for="name" class="input-label">Nom du vêtement <span style="color: #c62828;">*</span></label>
                                <input 
                                    type="text" 
                                    id="name"
                                    name="name" 
                                    placeholder="Ex: T-shirt bleu marine"
                                    required
                                    class="input-control"
                                >
                            </div>

                            <div class="input-field">
                                <label for="category" class="input-label">Catégorie</label>
                                <select id="category" name="category" class="input-control">
                                    <option value="">Sélectionner une catégorie</option>
                                    {% for category in categories %}
                                    <option value="{{ category.id }}">{{ category.icon }} {{ category.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="form-grid-full">
                            <div class="input-field">
                                <label for="description" class="input-label">Description</label>
                                <textarea 
                                    id="description"
                                    name="description" 
                                    placeholder="Décrivez ce vêtement..."
                                    rows="3"
                                    class="input-control"
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="section-title">Couleur</h3>
                        
                        <div class="form-grid">
                            <div class="input-field">
                                <label for="color" class="input-label">Couleur <span style="color: #c62828;">*</span></label>
                                <input 
                                    type="text" 
                                    id="color"
                                    name="color" 
                                    placeholder="Ex: Bleu marine"
                                    required
                                    class="input-control"
                                >
                            </div>

                            <div class="input-field">
                                <label for="color_hex" class="input-label">Code couleur (hex)</label>
                                <div style="display: flex; gap: 12px;">
                                    <input 
                                        type="color" 
                                        id="color_hex"
                                        name="color_hex"
                                        value="#DAD3C2"
                                        style="width: 60px; height: 44px; border: 1px solid #d9d9d9; cursor: pointer;"
                                    >
                                    <input 
                                        type="text" 
                                        id="color_hex_display"
                                        name="color_hex_display"
                                        placeholder="#RRGGBB"
                                        class="input-control"
                                        readonly
                                        style="flex: 1;"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="section-title">Détails supplémentaires</h3>
                        
                        <div class="form-grid">
                            <div class="input-field">
                                <label for="brand" class="input-label">Marque</label>
                                <input 
                                    type="text" 
                                    id="brand"
                                    name="brand" 
                                    placeholder="Ex: Nike, Zara..."
                                    class="input-control"
                                >
                            </div>

                            <div class="input-field">
                                <label for="material" class="input-label">Matière</label>
                                <input 
                                    type="text" 
                                    id="material"
                                    name="material" 
                                    placeholder="Ex: Coton 100%"
                                    class="input-control"
                                >
                            </div>

                            <div class="input-field">
                                <label for="pattern" class="input-label">Motif</label>
                                <select id="pattern" name="pattern" class="input-control">
                                    <option value="">Aucun</option>
                                    <option value="solid">Uni</option>
                                    <option value="striped">Rayé</option>
                                    <option value="floral">Fleuri</option>
                                    <option value="plaid">Carreaux</option>
                                    <option value="polka_dot">Pois</option>
                                    <option value="geometric">Géométrique</option>
                                    <option value="animal">Animal</option>
                                    <option value="other">Autre</option>
                                </select>
                            </div>

                            <div class="input-field">
                                <label for="condition" class="input-label">État</label>
                                <select id="condition" name="condition" class="input-control">
                                    <option value="good">Bon</option>
                                    <option value="new">Neuf</option>
                                    <option value="excellent">Excellent</option>
                                    <option value="fair">Correct</option>
                                    <option value="worn">Usé</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="section-title">Saisons et occasions</h3>
                        
                        <div class="form-grid-full">
                            <div class="input-field">
                                <label class="input-label">Saisons</label>
                                <div class="checkbox-grid" style="grid-template-columns: repeat(5, 1fr);">
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="seasons" value="spring">
                                        <span>Printemps</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="seasons" value="summer">
                                        <span>Été</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="seasons" value="fall">
                                        <span>Automne</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="seasons" value="winter">
                                        <span>Hiver</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="seasons" value="all_seasons">
                                        <span>Toutes saisons</span>
                                    </label>
                                </div>
                            </div>

                            <div class="input-field">
                                <label class="input-label">Occasions</label>
                                <div class="checkbox-grid" style="grid-template-columns: repeat(3, 1fr);">
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="occasions" value="casual">
                                        <span>Casual</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="occasions" value="formal">
                                        <span>Formel</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="occasions" value="sport">
                                        <span>Sport</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="occasions" value="party">
                                        <span>Soirée</span>
                                    </label>
                                    <label class="checkbox-card">
                                        <input type="checkbox" name="occasions" value="work">
                                        <span>Travail</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="section-title">Informations d'achat</h3>
                        
                        <div class="form-grid">
                            <div class="input-field">
                                <label for="purchase_date" class="input-label">Date d'achat</label>
                                <input type="date" id="purchase_date" name="purchase_date" class="input-control">
                            </div>

                            <div class="input-field">
                                <label for="purchase_price" class="input-label">Prix (EUR)</label>
                                <input 
                                    type="number" 
                                    id="purchase_price"
                                    name="purchase_price" 
                                    placeholder="0.00"
                                    step="0.01"
                                    min="0"
                                    class="input-control"
                                >
                            </div>

                            <div class="input-field">
                                <label for="purchase_location" class="input-label">Lieu d'achat</label>
                                <input 
                                    type="text" 
                                    id="purchase_location"
                                    name="purchase_location" 
                                    placeholder="Ex: Zara, H&M, Thrifted..."
                                    class="input-control"
                                >
                            </div>

                            <div class="input-field">
                                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #fafafa; border: 1px solid #d9d9d9; cursor: pointer; margin-top: 28px;">
                                    <input type="checkbox" name="is_secondhand">
                                    <span style="font-family: 'Inter', sans-serif; font-size: 14px; color: #252320;">Article de seconde main</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="section-title">Étiquettes</h3>
                        
                        <div class="form-grid-full">
                            <div class="input-field">
                                <label for="tags" class="input-label">Étiquettes (séparées par des virgules)</label>
                                <input 
                                    type="text" 
                                    id="tags"
                                    name="tags" 
                                    placeholder="Ex: confortable, été, bleu"
                                    class="input-control"
                                >
                                <small class="input-hint">Ajoutez des mots-clés pour faciliter la recherche</small>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <a href="{% url 'wardrobe_gallery' %}" class="btn btn-secondary">Annuler</a>
                        <button type="submit" class="btn btn-primary">Ajouter à ma garde-robe</button>
                    </div>
                </form>
            </div>

    <script>
        // Image preview
        const fileInput = document.getElementById('image-input');
        const imagePreview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        const uploadLabel = document.querySelector('.upload-label');
        const btnRemoveImage = document.querySelector('.btn-remove-image');

        fileInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImg.src = event.target.result;
                    imagePreview.style.display = 'flex';
                    uploadLabel.style.display = 'none';
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        btnRemoveImage.addEventListener('click', function(e) {
            e.preventDefault();
            fileInput.value = '';
            imagePreview.style.display = 'none';
            uploadLabel.style.display = 'flex';
        });

        // Drag and drop
        uploadLabel.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadLabel.style.background = '#f5f5f5';
        });

        uploadLabel.addEventListener('dragleave', () => {
            uploadLabel.style.background = '';
        });

        uploadLabel.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadLabel.style.background = '';
            fileInput.files = e.dataTransfer.files;
            fileInput.dispatchEvent(new Event('change'));
        });

        // Color picker sync
        const colorPicker = document.querySelector('.color-picker');
        const colorHexDisplay = document.querySelector('.color-hex-display');

        colorPicker.addEventListener('change', (e) => {
            colorHexDisplay.value = e.target.value.toUpperCase();
        });

        colorHexDisplay.addEventListener('change', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                colorPicker.value = e.target.value;
            }
        });

        // Fade in animation
        document.addEventListener('DOMContentLoaded', () => {
            document.body.style.opacity = '1';
        });
    </script>
{% endblock %}


