{% extends 'base.html' %}
{% load static %}

{% block title %}My Outfits - Tailora{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wardrobe.css' %}">
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
<link rel="stylesheet" href="{% static 'css/outfits.css' %}">
{% endblock %}

{% block content %}
            <!-- Page Header -->
            <div class="page-header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div>
                        <h1 class="page-title">My outfits</h1>
                        <p class="page-subtitle">{{ total_outfits }} outfit{{ total_outfits|pluralize }} ‚Ä¢ {{ favorite_count }} favorite{{ favorite_count|pluralize }}</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <a href="{% url 'outfits:challenges_list' %}" class="btn btn-secondary">Challenges</a>
                        <a href="{% url 'outfits:outfit_stats' %}" class="btn btn-secondary">Statistics</a>
                        <a href="{% url 'outfits:outfit_advanced_search' %}" class="btn btn-secondary">Advanced Search</a>
                        <a href="{% url 'outfits:outfit_create' %}" class="btn btn-primary">Create outfit</a>
                    </div>
                </div>
            </div>

            {% if daily_challenge %}
            <div style="margin-bottom: 32px; background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 50%, #3a3a3a 100%); border-radius: 18px; padding: 32px 40px; box-shadow: 0 12px 32px rgba(0,0,0,0.25); position: relative; overflow: hidden;">
                <!-- Decorative elements -->
                <div style="position: absolute; top: -40px; right: -40px; width: 180px; height: 180px; background: rgba(244,233,207,0.12); border-radius: 50%; filter: blur(25px);"></div>
                <div style="position: absolute; bottom: -50px; left: -50px; width: 200px; height: 200px; background: rgba(244,233,207,0.09); border-radius: 50%; filter: blur(30px);"></div>
                
                <div style="position: relative; display: flex; align-items: center; justify-content: space-between; gap: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 280px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span style="font-size: 26px;">üèÜ</span>
                            <span style="font-family: 'Inter', sans-serif; font-size: 12px; text-transform: uppercase; letter-spacing: 1.2px; color: #f4e9cf; font-weight: 700;">Today's Challenge</span>
                        </div>
                        <h3 style="margin: 0 0 12px 0; font-family: 'Istok Web', sans-serif; font-size: 28px; font-weight: 700; color: #ffffff; letter-spacing: -0.4px; line-height: 1.2;">{{ daily_challenge.name }}</h3>
                        <p style="margin: 0; font-family: 'Inter', sans-serif; font-size: 15px; color: rgba(255,255,255,0.92); line-height: 1.7; max-width: 680px;">{{ daily_challenge.description }}</p>
                        {% if daily_participation %}
                        <div style="margin-top: 16px; display: inline-block; padding: 8px 16px; background: rgba(129, 199, 132, 0.25); border-radius: 24px; border: 1px solid rgba(129, 199, 132, 0.4); font-family: 'Inter', sans-serif; font-size: 13px; color: #81c784; font-weight: 700; letter-spacing: 0.3px;">
                            ‚úì Challenge Joined
                        </div>
                        {% endif %}
                    </div>
                    <div style="display: flex; gap: 14px; align-items: center;">
                        {% if daily_participation %}
                            <a href="{% url 'outfits:challenge_detail' daily_challenge.id %}" class="btn btn-secondary" style="background: rgba(255,255,255,0.12); color: #ffffff; border: 1px solid rgba(255,255,255,0.25); font-weight: 600; padding: 14px 32px; font-size: 15px; letter-spacing: 0.4px; border-radius: 8px;">View Challenge</a>
                        {% else %}
                            <a href="{% url 'outfits:join_challenge' daily_challenge.id %}" class="btn btn-primary" style="background: #f4e9cf; color: #2c2c2c; border: none; font-weight: 700; padding: 14px 32px; font-size: 15px; letter-spacing: 0.5px; border-radius: 8px; box-shadow: 0 4px 12px rgba(244,233,207,0.25);">Accept Challenge</a>
                            <a href="{% url 'outfits:challenge_detail' daily_challenge.id %}" class="btn btn-secondary" style="background: rgba(255,255,255,0.12); color: #ffffff; border: 1px solid rgba(255,255,255,0.25); font-weight: 600; padding: 14px 32px; font-size: 15px; letter-spacing: 0.4px; border-radius: 8px;">Details</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Messages -->
            {% if messages %}
            <div style="margin-bottom: 24px;">
                {% for message in messages %}
                <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Filter Section -->
            <div class="filter-section">
                <form method="get" action="{% url 'outfits:outfit_gallery' %}">
                    <!-- Search Bar -->
                    <div style="display: flex; gap: 16px; margin-bottom: 20px;">
                        <input type="text" name="search" value="{{ search_query }}" placeholder="Search by name or description..." class="input-control" style="flex: 1;">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </div>

                    <!-- Filter Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <!-- Occasion Filter -->
                        <div class="input-field">
                            <label for="occasion" class="input-label">OCCASION</label>
                            <select name="occasion" id="occasion" class="input-control" onchange="this.form.submit()">
                                <option value="">All occasions</option>
                                {% for value, label in occasions %}
                                <option value="{{ value }}" {% if selected_occasion == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Favorites Filter -->
                        <div class="input-field">
                            <label class="checkbox-item-inline" style="display: flex; align-items: center; gap: 8px; margin-top: 32px;">
                                <input type="checkbox" name="favorites" value="true" {% if show_favorites %}checked{% endif %} onchange="this.form.submit()">
                                <span style="font-family: 'Inter', sans-serif; font-size: 14px; color: #2c2c2c; text-transform: uppercase; letter-spacing: 0.5px;">‚òÖ Favorites only</span>
                            </label>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 20px;">
                        <a href="{% url 'outfits:outfit_gallery' %}" class="btn btn-secondary">Reset</a>
                    </div>
                </form>
            </div>

            <!-- Outfits Grid -->
            <div class="content-section">
                {% if outfits %}
                <div class="wardrobe-grid">
                    {% for outfit in outfits %}
                    <div class="wardrobe-item">
                        <a href="{% url 'outfits:outfit_detail' outfit.id %}" class="item-link">
                            <div class="item-image">
                                {% if outfit.outfit_image %}
                                <img src="{{ outfit.outfit_image.url }}" alt="{{ outfit.name }}">
                                {% else %}
                                <!-- Placeholder for outfit without image - show first item or placeholder -->
                                {% with outfit.items.first as first_item %}
                                    {% if first_item %}
                                    <img src="{{ first_item.image.url }}" alt="{{ outfit.name }}">
                                    {% else %}
                                    <div class="item-placeholder">üëî Outfit</div>
                                    {% endif %}
                                {% endwith %}
                                {% endif %}
                            </div>
                            <div class="item-info">
                                <h3 class="item-name">{{ outfit.name }}</h3>
                                <p class="item-category">{{ outfit.get_occasion_display }}</p>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                                    <span style="font-family: 'Inter', sans-serif; font-size: 12px; color: #757575; text-transform: uppercase; letter-spacing: 0.5px;">{{ outfit.items.count }} item{{ outfit.items.count|pluralize }}</span>
                                    {% if outfit.favorite %}
                                    <span style="color: #2c2c2c; font-size: 16px;">‚òÖ</span>
                                    {% endif %}
                                </div>
                                {% if outfit.times_worn > 0 %}
                                <div style="display: flex; align-items: center; margin-top: 4px;">
                                    <span style="font-family: 'Inter', sans-serif; font-size: 11px; color: #757575; text-transform: uppercase; letter-spacing: 0.5px;">
                                        Worn {{ outfit.times_worn }} time{{ outfit.times_worn|pluralize }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </a>
                        <div class="item-actions">
                            <form method="post" action="{% url 'outfits:outfit_wear' outfit.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-icon" title="Mark as worn today">üëï</button>
                            </form>
                            <form method="post" action="{% url 'outfits:outfit_toggle_favorite' outfit.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-icon" title="{% if outfit.favorite %}Remove from favorites{% else %}Add to favorites{% endif %}">
                                    {% if outfit.favorite %}‚òÖ{% else %}‚òÜ{% endif %}
                                </button>
                            </form>
                            <a href="{% url 'outfits:outfit_detail' outfit.id %}" class="btn-icon" title="View">üëÅÔ∏è</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if outfits.has_other_pages %}
                <div class="pagination">
                    {% if outfits.has_previous %}
                    <a href="?page={{ outfits.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_occasion %}&occasion={{ selected_occasion }}{% endif %}{% if show_favorites %}&favorites=true{% endif %}" class="btn btn-secondary">‚Üê Previous</a>
                    {% endif %}
                    
                    <span style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575; text-transform: uppercase; letter-spacing: 0.5px;">
                        Page {{ outfits.number }} of {{ outfits.paginator.num_pages }}
                    </span>
                    
                    {% if outfits.has_next %}
                    <a href="?page={{ outfits.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_occasion %}&occasion={{ selected_occasion }}{% endif %}{% if show_favorites %}&favorites=true{% endif %}" class="btn btn-secondary">Next ‚Üí</a>
                    {% endif %}
                </div>
                {% endif %}
                {% else %}
                <!-- Empty State -->
                <div class="empty-state">
                    <div style="font-size: 64px; margin-bottom: 24px; opacity: 0.3;">üëî</div>
                    <h3 style="font-family: 'Istok Web', sans-serif; font-size: 24px; font-weight: 400; color: #2c2c2c; margin: 0 0 12px 0; text-transform: uppercase; letter-spacing: 1px;">
                        {% if search_query or selected_occasion or show_favorites %}
                        No outfits found
                        {% else %}
                        You don't have any outfits yet
                        {% endif %}
                    </h3>
                    <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575; margin: 0 0 32px 0;">
                        {% if search_query or selected_occasion or show_favorites %}
                        Try adjusting your search filters.
                        {% else %}
                        Create your first outfit by combining your wardrobe items!
                        {% endif %}
                    </p>
                    {% if not search_query and not selected_occasion and not show_favorites %}
                    <a href="{% url 'outfits:outfit_create' %}" class="btn btn-primary">CREATE MY FIRST OUTFIT</a>
                    {% else %}
                    <a href="{% url 'outfits:outfit_gallery' %}" class="btn btn-secondary">RESET FILTERS</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}