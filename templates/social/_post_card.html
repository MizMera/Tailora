<!-- [file name]: social/templates/social/_post_card.html -->
{% load custom_filters %}  <!-- âš ï¸ AJOUTER CETTE LIGNE -->

<div class="post-card content-section">
    <div class="post-header">
        <a href="{% url 'social:profile' post.user.id %}" class="post-user">
            <div class="user-avatar">{{ post.user.first_name|slice:":1"|upper }}</div>
            <div class="user-info">
                <span class="user-name">{{ post.user.get_full_name }}</span>
                <span class="post-time">{{ post.created_at|timesince }} ago</span>
            </div>
        </a>
    </div>
    
    <!-- SECTION GRILLE DES IMAGES -->
    <a href="{% url 'social:post_detail' post.id %}" class="post-outfit-link">
        <div class="post-outfit-grid">
            {% for item in post.outfit.items.all %}
            <div class="post-outfit-item" style="position: relative;">
                {% if post.enhanced_images and item.id|stringformat:"s" in post.enhanced_images %}
                    <!-- Afficher l'image amÃ©liorÃ©e par AI -->
                    <img src="/media/{{ post.enhanced_images|get_item:item.id|stringformat:'s' }}" 
                         alt="{{ item.name }}" 
                         style="border: 2px solid #ff4081;">
                    <div style="position: absolute; top: 5px; right: 5px; background: #ff4081; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; font-weight: bold;">
                        AI ğŸ¨
                    </div>
                {% elif item.image %}
                    <!-- Afficher l'image originale -->
                    <img src="{{ item.image.url }}" alt="{{ item.name }}">
                {% else %}
                    <div class="item-placeholder">No Image</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </a>
    
    <div class="post-actions">
        <form method="post" action="{% url 'social:toggle_like' post.id %}" class="post-action-form">
            {% csrf_token %}
            <button type="submit" class="btn-action {% if post.is_liked %}active{% endif %}">
                â¤ï¸ <span>{{ post.likes_count }}</span>
            </button>
        </form>
        <a href="{% url 'social:post_detail' post.id %}" class="btn-action">
            ğŸ’¬ <span>{{ post.comments_count }}</span>
        </a>
        <form method="post" action="{% url 'social:toggle_save' post.id %}" class="post-action-form">
            {% csrf_token %}
            <button type="submit" class="btn-action {% if post.is_saved %}active{% endif %}">
                ğŸ”– <span>{{ post.saves_count }}</span>
            </button>
        </form>
    </div>
    
    {% if post.caption %}
    <div class="post-caption">
        <a href="{% url 'social:profile' post.user.id %}" class="caption-user">{{ post.user.first_name }}</a>
        {{ post.caption }}
    </div>
    {% endif %}
    
    {% if post.hashtags %}
    <div class="post-hashtags">
        {% for tag in post.hashtags %}
            <span class="hashtag">{{ tag }}</span>
        {% endfor %}
    </div>
    {% endif %}
    
    <a href="{% url 'outfits:outfit_detail' post.outfit.id %}" class="post-outfit-name">
        View outfit: {{ post.outfit.name }}
    </a>

    {% if post.user == request.user %}
        <div class="post-owner-actions" style="margin-top: 15px; display: flex; gap: 10px;">
            <a href="{% url 'social:edit_post' post.id %}" class="btn btn-secondary btn-sm">âœï¸ Edit Post</a>
            <form method="post" action="{% url 'social:delete_post' post.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this post?')">ğŸ—‘ï¸ Delete Post</button>
            </form>
        </div>
    {% endif %}
</div>