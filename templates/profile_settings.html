{% extends 'base.html' %}
{% load static %}

{% block title %}Profile Settings - Tailora{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}

{% block container_class %}page-reveal{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
        <div>
            <h1 class="page-title">Profile Settings</h1>
            <p class="page-subtitle">Manage your account and preferences</p>
        </div>
        <div style="display: flex; gap: 12px;">
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                <span style="margin-right: 6px;">←</span> Dashboard
            </a>
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary" style="border: none; cursor: pointer;">Log out</button>
            </form>
        </div>
    </div>
</div>

<div class="settings-wrapper">
    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="message {% if message.tags == 'error' %}message-error{% elif message.tags == 'success' %}message-success{% else %}message-info{% endif %}">
                {% if message.tags == 'success' %}
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                {% elif message.tags == 'error' %}
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                {% else %}
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                {% endif %}
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Settings Grid Layout -->
    <div class="settings-grid">
        <!-- Main Settings Form -->
        <div class="settings-main">
            <form method="post" enctype="multipart/form-data" id="settingsForm">
                {% csrf_token %}

                <!-- Personal Information -->
                <div class="settings-section">
                    <h3 class="section-title">Personal Information</h3>
                    
                    <!-- Profile Image Upload -->
                    <div class="profile-upload">
                        {% if user.profile_image %}
                            <img src="{{ user.profile_image.url }}" alt="Profile" class="profile-preview">
                        {% else %}
                            <div class="profile-placeholder">{{ user.first_name.0|default:user.username.0|upper }}</div>
                        {% endif %}
                        <div class="profile-upload-info">
                            <div class="profile-upload-title">Profile Photo</div>
                            <div class="profile-upload-hint">JPG, PNG or GIF • Max 2MB</div>
                            <div class="file-input-wrapper">
                                <input type="file" id="profile_image" name="profile_image" accept="image/*">
                                <label for="profile_image" class="file-input-label">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                                    Upload Photo
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid" style="margin-top: 28px;">
                        <div class="input-field">
                            <label for="first_name" class="input-label">First Name</label>
                            <input type="text" id="first_name" name="first_name" 
                                   class="input-control" value="{{ user.first_name }}" placeholder="Enter your first name">
                        </div>

                        <div class="input-field">
                            <label for="last_name" class="input-label">Last Name</label>
                            <input type="text" id="last_name" name="last_name" 
                                   class="input-control" value="{{ user.last_name }}" placeholder="Enter your last name">
                        </div>

                        <div class="input-field">
                            <label for="email" class="input-label">Email Address</label>
                            <input type="email" id="email" class="input-control" 
                                   value="{{ user.email }}" disabled>
                            <small class="input-hint">Email cannot be changed for security reasons</small>
                        </div>

                        <div class="input-field">
                            <label for="phone" class="input-label">Phone Number</label>
                            <input type="tel" id="phone" name="phone" 
                                   class="input-control" value="{{ user.phone|default:'' }}" placeholder="+1 (555) 000-0000">
                        </div>
                    </div>
                </div>

                <!-- Style Preferences -->
                <div class="settings-section">
                    <h3 class="section-title">Style Preferences</h3>
                    
                    <div class="form-grid-full">
                        <div class="input-field">
                            <label class="input-label">Preferred Styles</label>
                            <p class="input-hint" style="margin-bottom: 12px;">Select the styles that best describe your fashion taste</p>
                            <div class="checkbox-grid">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="casual"
                                           {% if 'casual' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Casual</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="chic"
                                           {% if 'chic' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Chic</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="boheme"
                                           {% if 'boheme' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Bohemian</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="sportif"
                                           {% if 'sportif' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Sporty</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="elegant"
                                           {% if 'elegant' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Elegant</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="classique"
                                           {% if 'classique' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Classic</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="streetwear"
                                           {% if 'streetwear' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Streetwear</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="vintage"
                                           {% if 'vintage' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Vintage</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="preferred_styles" value="minimaliste"
                                           {% if 'minimaliste' in style_profile.preferred_styles %}checked{% endif %}>
                                    <span>Minimalist</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid" style="margin-top: 28px;">
                        <div class="input-field">
                            <label for="body_type" class="input-label">Body Type</label>
                            <select id="body_type" name="body_type" class="input-control">
                                <option value="">Select your body type...</option>
                                <option value="rectangle" {% if style_profile.body_type == 'rectangle' %}selected{% endif %}>Rectangle</option>
                                <option value="triangle" {% if style_profile.body_type == 'triangle' %}selected{% endif %}>Triangle (Pear)</option>
                                <option value="triangle_inverse" {% if style_profile.body_type == 'triangle_inverse' %}selected{% endif %}>Inverted Triangle</option>
                                <option value="sablier" {% if style_profile.body_type == 'sablier' %}selected{% endif %}>Hourglass</option>
                                <option value="ovale" {% if style_profile.body_type == 'ovale' %}selected{% endif %}>Oval (Apple)</option>
                            </select>
                        </div>

                        <div class="input-field">
                            <label for="height" class="input-label">Height</label>
                            <input type="number" id="height" name="height" 
                                   class="input-control" min="100" max="250" 
                                   value="{{ style_profile.height|default:'' }}" placeholder="Height in cm">
                        </div>
                    </div>

                    <div class="form-grid-full">
                        <div class="input-field">
                            <label class="input-label">Favorite Colors</label>
                            <p class="input-hint" style="margin-bottom: 12px;">Choose colors you love to wear</p>
                            <div class="color-grid">
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#000000"
                                           {% if '#000000' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-black"></span>
                                    <span class="color-name">Black</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#FFFFFF"
                                           {% if '#FFFFFF' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-white"></span>
                                    <span class="color-name">White</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#808080"
                                           {% if '#808080' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-gray"></span>
                                    <span class="color-name">Grey</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#0000FF"
                                           {% if '#0000FF' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-blue"></span>
                                    <span class="color-name">Blue</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#FF0000"
                                           {% if '#FF0000' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-red"></span>
                                    <span class="color-name">Red</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#008000"
                                           {% if '#008000' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-green"></span>
                                    <span class="color-name">Green</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#FFFF00"
                                           {% if '#FFFF00' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-yellow"></span>
                                    <span class="color-name">Yellow</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#FFC0CB"
                                           {% if '#FFC0CB' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-pink"></span>
                                    <span class="color-name">Pink</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#A52A2A"
                                           {% if '#A52A2A' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-brown"></span>
                                    <span class="color-name">Brown</span>
                                </label>
                                <label class="color-option">
                                    <input type="checkbox" name="favorite_colors" value="#F5DEB3"
                                           {% if '#F5DEB3' in style_profile.favorite_colors %}checked{% endif %}>
                                    <span class="color-box color-beige"></span>
                                    <span class="color-name">Beige</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid-full" style="margin-top: 28px;">
                        <div class="input-field">
                            <label class="input-label">Shopping Preferences</label>
                            <p class="input-hint" style="margin-bottom: 12px;">Tell us about your shopping values</p>
                            <div class="checkbox-grid" style="grid-template-columns: repeat(2, 1fr);">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="prefers_sustainable" value="true"
                                           {% if style_profile.prefers_sustainable %}checked{% endif %}>
                                    <span>Eco-Friendly</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="prefers_secondhand" value="true"
                                           {% if style_profile.prefers_secondhand %}checked{% endif %}>
                                    <span>Second-Hand</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>

        <!-- Sidebar -->
        <div class="settings-sidebar">
            <!-- Account Status -->
            <div class="security-card">
                <h3 class="security-title">
                    <svg class="section-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    Account Status
                </h3>
                <div class="security-info">
                    <div class="security-label">Email</div>
                    <div class="security-value">
                        {{ user.email }}
                        {% if user.is_verified %}
                            <span class="security-status status-verified">Verified</span>
                        {% else %}
                            <span class="security-status status-unverified">Unverified</span>
                        {% endif %}
                    </div>
                </div>
                <div class="security-info">
                    <div class="security-label">Member Since</div>
                    <div class="security-value">{{ user.date_joined|date:"F Y" }}</div>
                </div>
                <div class="security-info">
                    <div class="security-label">Account Type</div>
                    <div class="security-value">
                        {% if user.is_premium_user %}
                            <span class="premium-badge">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                                Premium
                            </span>
                            {% if user.role != 'premium' and user.premium_until %}
                                <span style="font-size: 12px; color: #888;">(Trial)</span>
                            {% endif %}
                        {% else %}
                            Free Account
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Security Actions -->
            <div class="security-card">
                <h3 class="security-title">
                    <svg class="section-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                    Security
                </h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <a href="{% url 'change_password' %}" class="btn btn-secondary" style="width: 100%; text-align: center;">
                        Change Password
                    </a>
                    {% if not user.is_verified %}
                    <a href="{% url 'resend_verification' %}" class="btn btn-secondary" style="width: 100%; text-align: center;">
                        Resend Verification
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Subscription Management -->
            {% if user.is_premium_user %}
                <div class="security-card" style="border-left: 4px solid #4CAF50;">
                    <h3 class="security-title" style="color: #4CAF50;">
                        <svg class="section-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                        Subscription
                    </h3>
                    {% if user.role == 'premium' %}
                        <p style="font-size: 13px; color: #555; margin-bottom: 16px; line-height: 1.6;">
                            You're a Premium member! Thank you for your support.
                        </p>
                        <form method="post" action="{% url 'cancel_subscription' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-secondary" style="width: 100%;">Cancel Subscription</button>
                        </form>
                    {% elif user.premium_until %}
                        <p style="font-size: 13px; color: #555; margin-bottom: 12px; line-height: 1.6;">
                            Trial ends <strong>{{ user.premium_until|date:"F d, Y" }}</strong>
                        </p>
                        <a href="{% url 'upgrade_account' %}" class="btn btn-primary" style="width: 100%; text-align: center; background: linear-gradient(135deg, #4CAF50, #66bb6a); border: none; margin-bottom: 10px;">
                            Upgrade to Full Premium
                        </a>
                        <form method="post" action="{% url 'cancel_subscription' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-secondary" style="width: 100%;">Cancel Trial</button>
                        </form>
                    {% endif %}
                </div>
            {% else %}
                <!-- Upgrade to Premium -->
                <div class="security-card" style="border-left: 4px solid #4CAF50;">
                    <h3 class="security-title" style="color: #4CAF50;">
                        <svg class="section-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                        Go Premium
                    </h3>
                    <p style="font-size: 13px; color: #555; margin-bottom: 16px; line-height: 1.6;">
                        Unlock AI recommendations, unlimited outfits & more!
                    </p>
                    <a href="{% url 'upgrade_account' %}" class="btn btn-primary" style="width: 100%; text-align: center; background: linear-gradient(135deg, #4CAF50, #66bb6a); border: none;">
                        Upgrade Now
                    </a>
                </div>
            {% endif %}

            <!-- Danger Zone -->
            <div class="security-card" style="border-left: 4px solid #c62828;">
                <h3 class="security-title" style="color: #c62828;">
                    <svg class="section-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    Danger Zone
                </h3>
                <p style="font-size: 12px; color: #777; margin-bottom: 16px; line-height: 1.5;">
                    Permanently delete your account and all data. This action cannot be undone.
                </p>
                <a href="{% url 'request_account_deletion' %}" class="btn btn-primary" style="width: 100%; text-align: center; background: linear-gradient(135deg, #c62828, #d32f2f); border: none;">
                    Delete Account
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
