{% extends 'base.html' %}
{% load static %}

{% block title %}Submit Outfit - {{ challenge.name }} - Tailora{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wardrobe.css' %}">
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
<style>
.outfit-selection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 24px;
}
.outfit-card {
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 14px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.outfit-card:hover {
    border-color: #d0d0d0;
    transform: translateY(-6px);
    box-shadow: 0 10px 28px rgba(0,0,0,0.12);
}
.outfit-card input[type="radio"] {
    display: none;
}
.outfit-card:has(input[type="radio"]:checked) {
    border-color: #2c2c2c;
    background: #f4e9cf;
    box-shadow: 0 6px 20px rgba(44,44,44,0.18);
}
.outfit-image {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 4px;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Submit Outfit</h1>
        <p class="page-subtitle">{{ challenge.name }}</p>
    </div>
</div>

<div class="content-section">
    <div style="margin-bottom: 24px;">
        <h3 style="font-family: 'Istok Web', sans-serif; margin-bottom: 8px;">Challenge Details</h3>
        <p style="color: #757575;">{{ challenge.description }}</p>
        <div style="margin-top: 12px;">
            <span style="font-size: 12px; text-transform: uppercase; color: #757575;">Progress: {{ participation.outfits_submitted }}/{{ challenge.rules.required_outfits|default:challenge.duration_days }} outfits</span>
        </div>
    </div>

    <form method="post" action="{% url 'outfits:submit_challenge_outfit' challenge.id %}">
        {% csrf_token %}
        
        <h3 style="font-family: 'Istok Web', sans-serif; margin-bottom: 16px;">Select an Outfit</h3>
        
        {% if available_outfits %}
        <div class="outfit-selection-grid">
            {% for outfit in available_outfits %}
            <label class="outfit-card">
                <input type="radio" name="outfit" value="{{ outfit.id }}" required>
                <div>
                    <div class="outfit-image">
                        {% if outfit.outfit_image %}
                        <img src="{{ outfit.outfit_image.url }}" alt="{{ outfit.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        {% with outfit.items.first as first_item %}
                            {% if first_item %}
                            <img src="{{ first_item.image.url }}" alt="{{ outfit.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% else %}
                            <span style="font-size: 48px;">ðŸ‘”</span>
                            {% endif %}
                        {% endwith %}
                        {% endif %}
                    </div>
                    <h4 style="margin: 8px 0 4px 0; font-family: 'Istok Web', sans-serif; font-size: 14px;">{{ outfit.name }}</h4>
                    <p style="margin: 0; font-size: 12px; color: #757575;">{{ outfit.items.count }} items</p>
                </div>
            </label>
            {% endfor %}
        </div>
        
        <div style="margin-top: 24px;">
            <label for="notes" class="input-label">Notes (Optional)</label>
            <textarea name="notes" id="notes" rows="3" class="input-control" placeholder="Add any notes about this outfit..."></textarea>
        </div>
        
        <div style="display: flex; gap: 12px; margin-top: 24px;">
            <button type="submit" class="btn btn-primary">Submit Outfit</button>
            <a href="{% url 'outfits:challenge_detail' challenge.id %}" class="btn btn-secondary">Cancel</a>
        </div>
        {% else %}
        <div class="empty-state">
            <div style="font-size: 64px; margin-bottom: 24px; opacity: 0.3;">ðŸ‘”</div>
            <h3 style="font-family: 'Istok Web', sans-serif; font-size: 24px; font-weight: 400; color: #2c2c2c; margin: 0 0 12px 0;">
                No available outfits
            </h3>
            <p style="font-family: 'Inter', sans-serif; font-size: 14px; color: #757575; margin: 0 0 32px 0;">
                You've already submitted all your outfits for this challenge, or you don't have any outfits yet.
            </p>
            <a href="{% url 'outfits:outfit_create' %}" class="btn btn-primary">Create New Outfit</a>
        </div>
        {% endif %}
    </form>
</div>
{% endblock %}
